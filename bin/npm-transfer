#!/usr/bin/env node

var yesno = require("yesno")

var program = require('commander')
  .version(require('../package.json').version)
  .usage('<user>')
  .parse(process.argv)

var user = program.args[0]
if (!user) throw new Error('an npm user must be set')

var exec = require('child_process').execFileSync
var me = exec('npm', ['whoami']).toString().trim()
var packages = program.args.slice(1)
if (packages.length <= 0) {
  packages = exec('curl', ['-s', 'https://registry.cnpmjs.org/-/by-user/' + me])
  packages = JSON.parse(packages.toString())[me]
}

(function npm_transfer (modules) {
  if (modules.length <= 0) {
    process.exit(0)
  } else {
    var package = modules[0]
    yesno.ask('transfer npm publishing rights of "'+package+'" from user "'+me+'" to user "'+user+'"?',
      false,
      function (ok) {
        if (ok) {
          exec('npm', ['owner', 'add', user, package])
          console.log('package "%s" has been transferred from user "%s" to "%s"', package, me, user)
        }
        npm_transfer(modules.slice(1))
      })
  }
})(packages)
